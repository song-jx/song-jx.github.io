<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#222">
  <link rel="manifest" href="/manifest.json">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Pisces","version":"8.7.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>
<meta name="description" content="AUOJ1760  有 \(n\) 个物品，其中可能有一个次品，它的质量与其他物品有差异。你需要多次使用天平后回答谜题：是否存在次品？次品是偏轻还是偏重？称量时，在天平两边放相同数量的物品，以得知那边更重。 构造一个能够解决谜题且称量次数最少的固定称量方案。 \(n \le 10^6\)  考虑什么样的称量方案能够解决谜题。 假设称量次数为 \(m\)，定义矩阵 \(A\)： \[ A_{i,j}">
<meta property="og:type" content="article">
<meta property="og:title" content="考试题">
<meta property="og:url" content="http://example.com/exams/index.html">
<meta property="og:site_name" content="platelet&#39;s blog">
<meta property="og:description" content="AUOJ1760  有 \(n\) 个物品，其中可能有一个次品，它的质量与其他物品有差异。你需要多次使用天平后回答谜题：是否存在次品？次品是偏轻还是偏重？称量时，在天平两边放相同数量的物品，以得知那边更重。 构造一个能够解决谜题且称量次数最少的固定称量方案。 \(n \le 10^6\)  考虑什么样的称量方案能够解决谜题。 假设称量次数为 \(m\)，定义矩阵 \(A\)： \[ A_{i,j}">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-09-17T08:27:28.000Z">
<meta property="article:modified_time" content="2021-09-22T07:38:33.258Z">
<meta property="article:author" content="platelet">
<meta property="article:tag" content="platelet">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/exams/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://example.com/exams/","path":"exams/","title":"考试题"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>考试题 | platelet's blog</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">platelet's blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">精于心，简于形</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-links"><a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>友链</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
        <li class="menu-item menu-item-template"><a href="/template/" rel="section"><i class="fa fa-code fa-fw"></i>模板</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#auoj1760"><span class="nav-number">1.</span> <span class="nav-text">AUOJ1760</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E4%B8%80"><span class="nav-number">2.</span> <span class="nav-text">思路一</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E4%BA%8C"><span class="nav-number">3.</span> <span class="nav-text">思路二</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E4%B8%89"><span class="nav-number">4.</span> <span class="nav-text">思路三</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#auoj1761"><span class="nav-number">5.</span> <span class="nav-text">AUOJ1761</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#catoj1009"><span class="nav-number">6.</span> <span class="nav-text">CatOJ1009</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#catoj1011"><span class="nav-number">7.</span> <span class="nav-text">CatOJ1011</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="platelet"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">platelet</p>
  <div class="site-description" itemprop="description">天地不仁<br>platelet.top | 血小板.top<br>song-jx.github.io</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">51</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">38</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



          </div>
        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/exams/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="platelet">
      <meta itemprop="description" content="天地不仁<br>platelet.top | 血小板.top<br>song-jx.github.io">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="platelet's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          考试题
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-09-17 16:27:28" itemprop="dateCreated datePublished" datetime="2021-09-17T16:27:28+08:00">2021-09-17</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-09-22 15:38:33" itemprop="dateModified" datetime="2021-09-22T15:38:33+08:00">2021-09-22</time>
      </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    
      <a title="changyan" href="/exams/#SOHUCS" itemprop="discussionUrl">
        <span id="changyan_count_unit" class="post-comments-count hc-comment-count" data-xid="exams/" itemprop="commentCount"></span>
      </a>
    
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>9.3k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>8 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h3 id="auoj1760">AUOJ1760</h3>
<blockquote>
<p>有 <span class="math inline">\(n\)</span> 个物品，其中可能有一个次品，它的质量与其他物品有差异。你需要多次使用天平后回答谜题：是否存在次品？次品是偏轻还是偏重？称量时，在天平两边放相同数量的物品，以得知那边更重。</p>
<p>构造一个能够解决谜题且称量次数最少的<strong>固定</strong>称量方案。</p>
<p><span class="math inline">\(n \le 10^6\)</span></p>
</blockquote>
<p>考虑什么样的称量方案能够解决谜题。</p>
<p>假设称量次数为 <span class="math inline">\(m\)</span>，定义矩阵 <span class="math inline">\(A\)</span>： <span class="math display">\[
A_{i,j}=
\begin{cases}
-1 &amp;(第 j 次称量物品 i 在天平左边)\\
0 &amp;(第 j 次称量物品 i 不在天平上)\\
1 &amp;(第 j 次称量物品 i 在天平右边)
\end{cases}
\]</span> 首先怎么判断有没有次品：如果有物品没上过天平，哪无论如何都不能判断，否则可以判断，不存在次品当且仅当每次天平都平衡。</p>
<p>得到条件一：<span class="math inline">\(A_i\ne \{0,0,\cdots, 0\}\)</span>。</p>
<p>确定了有次品，怎么确定是哪一个：先考虑已知次品偏重时怎么确定，根据每次天平的倾斜情况，可以得到每次称量时次品在天平的哪一边或不在天平上，定义序列 <span class="math inline">\(B\)</span>： <span class="math display">\[
B_i=
\begin{cases}
-1 &amp;(第 i 次称量次品在天平左边)\\
0 &amp;(第 i 次称量次品不在天平上)\\
1 &amp;(第 i 次称量次品在天平右边)
\end{cases}
\]</span> 然后看 <span class="math inline">\(B\)</span> 和 <span class="math inline">\(A_?\)</span> 相等就可以确定次品是哪一个。</p>
<p>但是并不知道次品偏重还是偏轻，上面说了假设次品偏重可以得到一个序列 <span class="math inline">\(B\)</span>，类似地假设次品偏轻可以得到一个序列 <span class="math inline">\(C\)</span>，并且满足 <span class="math inline">\(C=-B\)</span>（元素对于互为相反数），可以解决谜题的条件是 <span class="math inline">\(B\)</span> 和 <span class="math inline">\(C\)</span> 不能同时和某个 <span class="math inline">\(A_i\)</span> 相等。</p>
<p>得到条件二：<span class="math inline">\(\forall i \ne j, A_i\ne A_j \land A_i \ne -A_j\)</span>。</p>
<p>由于每次称量时两边放相同数量的物品。</p>
<p>得到条件三：<span class="math inline">\(\forall j\in[1,m],\sum_{i=1}^nA_{i,j}=0\)</span>。</p>
<p>满足以上三个条件就已经合法了，考虑对于一个 <span class="math inline">\(m\)</span>，哪些 <span class="math inline">\(n\)</span> 可以构造出 <span class="math inline">\(A\)</span> 矩阵。</p>
<p>首先在前两个条件的限制下，<span class="math inline">\(n\)</span> 最大能取得 <span class="math inline">\(\frac{3^m-1}2\)</span>，再加上第三个限制，<span class="math inline">\(n\)</span> 还能不能取到 <span class="math inline">\(\frac{3^m-1}2\)</span>？</p>
<p>答案是否定的，因为对于所有的方案，<span class="math inline">\(\forall j\in[1,m],\sum_{i=1}^n|A_{i,j}|=3^{m-1}\)</span>。</p>
<blockquote>
<p>引理，<span class="math inline">\(m\)</span> 次称量可以解决谜题当且仅当 <span class="math inline">\(n\le \frac{3^m-3}2\)</span>。</p>
</blockquote>
<p>这样就可以求出最小的 <span class="math inline">\(m\)</span> 了，怎么求方案？</p>
<p>当 <span class="math inline">\(3|n\)</span> 时有一个简单的构造：定义 <span class="math inline">\(\text{next}(A)\)</span> 表示把序列 <span class="math inline">\(A\)</span> 每一项循环移位（<span class="math inline">\(-1\rightarrow 0,0\rightarrow 1,1\rightarrow -1\)</span>）后得到的序列，不难发现一个事实，<span class="math inline">\(A,\text{next}(A),\text{next}(\text{next}(A))\)</span> 这三个序列对应位置之和等于 <span class="math inline">\(0\)</span>。</p>
<p>如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1 0 -1 1</span><br><span class="line">-1 1 0 -1</span><br><span class="line">0 -1 1 0</span><br></pre></td></tr></table></figure>
<p>除去 <span class="math inline">\(\{-1,-1,\cdots,-1\}\)</span> 和 <span class="math inline">\(\{1,1,\cdots,1\}\)</span>，把每三个这样的序列分为一组，恰好可以分成 <span class="math inline">\(\frac {3^m-3}3\)</span> 组，其中两两组互相为相反序列，于是删去一 半这样的组，恰好可以得到一个合法的矩阵 <span class="math inline">\(A\)</span>。</p>
<h3 id="思路一">思路一</h3>
<p>当 <span class="math inline">\(3\not|n\)</span> 时，感觉问题非常困难，考虑模拟退火：</p>
<ul>
<li>用 <span class="math inline">\(\sum_{j=1}^m|\sum_{i=1}^nA_{i,j}|\)</span> 作为一个解的权值，问题就是求权值最小的解。</li>
<li>还是先分组，取若干个组和一个不完整的组作为初始解。</li>
<li>每次以以下方式之一生成一个新解，如果新解更优则接受新解，否则以很低的概率接受新解。
<ul>
<li>选择一个 <span class="math inline">\(i\)</span>，将 <span class="math inline">\(A_i\)</span> 替换成 <span class="math inline">\(-A_i\)</span>。</li>
<li>选择一个 <span class="math inline">\(i\)</span>，选择一个 <span class="math inline">\(B\)</span> 满足 <span class="math inline">\(B\)</span> 和 <span class="math inline">\(-B\)</span> 都没有在 <span class="math inline">\(A\)</span> 中出现过，令 <span class="math inline">\(A_i=B\)</span>。</li>
</ul></li>
</ul>
<p>效率还行，但不稳定，对于少数 <span class="math inline">\(n\)</span> 速度极慢，<span class="math inline">\(n\le 10^4\)</span> 是完全没有问题的。</p>
<details>
<summary>
<span style="font-size: large; font-weight: bold; color: rgb(33,150,243);">查看代码</span>
</summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rep(i, l, r) for(int i = (l); i &lt;= (r); i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> per(i, r, l) for(int i = (r); i &gt;= (l); i--)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> mem(a, b) memset(a, b, sizeof a)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> For(i, l, r) for(int i = (l), i##e = (r); i &lt; i##e; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pb push_back</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> ll = <span class="keyword">long</span> <span class="keyword">long</span>;</span><br><span class="line"><span class="keyword">using</span> lf = <span class="keyword">double</span>;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">gen</span><span class="params">(ll x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> ll k = <span class="number">0x9ddfea08eb382d69</span>ull;</span><br><span class="line">    <span class="built_in">rep</span>(i, <span class="number">1</span>, <span class="number">3</span>) x *= k, x ^= x &gt;&gt; <span class="number">47</span>;</span><br><span class="line">    <span class="keyword">return</span> x * k;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">rnd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> ll s = <span class="built_in">time</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> (s += <span class="built_in">gen</span>(s)) &amp; INT_MAX;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">wrt</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> ed)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> streambuf* out = cout.<span class="built_in">rdbuf</span>();</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> pc out -&gt; sputc</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">char</span> c[<span class="number">11</span>]; <span class="keyword">int</span> sz = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span> c[++sz] = x % <span class="number">10</span>, x /= <span class="number">10</span>; <span class="keyword">while</span>(x);</span><br><span class="line">    <span class="keyword">while</span>(sz) <span class="built_in">pc</span>(c[sz--] + <span class="number">48</span>);</span><br><span class="line">    <span class="built_in">pc</span>(ed);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> n, m = <span class="number">2</span>, t = <span class="number">9</span>, nw[<span class="number">15</span>], idx, A[<span class="number">2500000</span>][<span class="number">15</span>], c[<span class="number">15</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(i &gt; m) &#123;</span><br><span class="line">        <span class="built_in">rep</span>(j, <span class="number">2</span>, <span class="number">4</span>) &#123;</span><br><span class="line">            idx++;</span><br><span class="line">            <span class="built_in">rep</span>(k, <span class="number">1</span>, m) A[idx][k] = (nw[k] + j) % <span class="number">3</span> - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(idx == t) <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">rep</span>(j, <span class="number">-1</span>, <span class="number">1</span>) &#123;</span><br><span class="line">		nw[i] = j, <span class="built_in">dfs</span>(i + <span class="number">1</span>);</span><br><span class="line">		<span class="keyword">if</span>(idx == t) <span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>), cin.<span class="built_in">tie</span>(<span class="number">0</span>), cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">while</span>(t - <span class="number">3</span> &gt;&gt; <span class="number">1</span> &lt; n) m++, t *= <span class="number">3</span>;</span><br><span class="line">    <span class="built_in">wrt</span>(m, <span class="number">10</span>);</span><br><span class="line">    t = t - <span class="number">1</span> &gt;&gt; <span class="number">1</span>, <span class="built_in">dfs</span>(<span class="number">2</span>);</span><br><span class="line">    <span class="built_in">rep</span>(i, <span class="number">1</span>, n) <span class="built_in">rep</span>(j, <span class="number">1</span>, m) c[j] += A[i][j];</span><br><span class="line">    <span class="keyword">int</span> su = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">rep</span>(i, <span class="number">1</span>, m) su += <span class="built_in">abs</span>(c[i]);</span><br><span class="line">    <span class="keyword">while</span>(su) &#123;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="built_in">rnd</span>() % n + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">rnd</span>() % t &lt; n) &#123;</span><br><span class="line">            <span class="keyword">int</span> d = <span class="number">0</span>;</span><br><span class="line">            <span class="built_in">rep</span>(j, <span class="number">1</span>, m) d += <span class="built_in">abs</span>(c[j] - <span class="number">2</span> * A[i][j]);</span><br><span class="line">            <span class="keyword">if</span>(d &lt; su || <span class="built_in">rnd</span>() % n &lt; <span class="number">10</span>) &#123;</span><br><span class="line">                su = d;</span><br><span class="line">                <span class="built_in">rep</span>(j, <span class="number">1</span>, m) c[j] -= <span class="number">2</span> * A[i][j], A[i][j] *= <span class="number">-1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">int</span> k = <span class="built_in">rnd</span>() % (t - n) + n + <span class="number">1</span>, d = <span class="number">0</span>;</span><br><span class="line">            <span class="built_in">rep</span>(j, <span class="number">1</span>, m) d += <span class="built_in">abs</span>(c[j] - A[i][j] + A[k][j]);</span><br><span class="line">            <span class="keyword">if</span>(d &lt; su || <span class="built_in">rnd</span>() % n &lt; <span class="number">10</span>) &#123;</span><br><span class="line">				su = d;</span><br><span class="line">				<span class="built_in">rep</span>(j, <span class="number">1</span>, m) c[j] -= A[i][j] - A[k][j], <span class="built_in">swap</span>(A[i][j], A[k][j]);</span><br><span class="line">			&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">rep</span>(i, <span class="number">1</span>, n) &#123;</span><br><span class="line">        <span class="keyword">int</span> v = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">per</span>(j, m, <span class="number">1</span>) v = v * <span class="number">3</span> + A[i][j] + <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">wrt</span>(v, <span class="number">32</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<h3 id="思路二">思路二</h3>
<p>另外，还有一种优秀的乱搞做法。</p>
<ul>
<li>先分组，取若干个组和一个不完整的组作为初始解，那么 <span class="math inline">\(\forall j\in[1,m],|\sum_{i=1}^nA_{i,j}|\le 1\)</span>。</li>
<li>对于每个 <span class="math inline">\(j\)</span>，如果 <span class="math inline">\(\sum_{i=1}^nA_{i,j}=-1\)</span>，找到一个 <span class="math inline">\(i\)</span> 满足 <span class="math inline">\(A_{i,j}&lt;1\)</span> 并且将 <span class="math inline">\(A_{i,j}\)</span> 增大一后仍然合法，然后将 <span class="math inline">\(A_{i,j}\)</span> 加一。</li>
</ul>
<p>会有极个别 <span class="math inline">\(n\)</span> 求出的解不合法，<span class="math inline">\(10^6\)</span> 以内应该不会超过 <span class="math inline">\(10\)</span> 个，而且都比较小，取决于初始解（所有可以通过）。</p>
<p>结合思路一可以构造出 <span class="math inline">\(10^6\)</span> 内的所有 <span class="math inline">\(n\)</span>。</p>
<details>
<summary>
<span style="font-size: large; font-weight: bold; color: rgb(33,150,243);">查看代码</span>
</summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rep(i, l, r) for(int i = (l); i &lt;= (r); i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> per(i, r, l) for(int i = (r); i &gt;= (l); i--)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> mem(a, b) memset(a, b, sizeof a)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> For(i, l, r) for(int i = (l), i##e = (r); i &lt; i##e; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pb push_back</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> ll = <span class="keyword">long</span> <span class="keyword">long</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">wrt</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> ed)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> streambuf* out = cout.<span class="built_in">rdbuf</span>();</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> pc out -&gt; sputc</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">char</span> c[<span class="number">11</span>]; <span class="keyword">int</span> sz = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span> c[++sz] = x % <span class="number">10</span>, x /= <span class="number">10</span>; <span class="keyword">while</span>(x);</span><br><span class="line">    <span class="keyword">while</span>(sz) <span class="built_in">pc</span>(c[sz--] + <span class="number">48</span>);</span><br><span class="line">    <span class="built_in">pc</span>(ed);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> n, m = <span class="number">2</span>, t = <span class="number">9</span>, nw[<span class="number">15</span>], idx, A[<span class="number">1000005</span>], c[<span class="number">15</span>], as;</span><br><span class="line"><span class="keyword">bool</span> vs[<span class="number">1600000</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(i) <span class="built_in">rep</span>(j, <span class="number">-1</span>, <span class="number">1</span>) &#123; nw[i] = j, <span class="built_in">dfs</span>(i - <span class="number">1</span>); <span class="keyword">if</span>(idx == n) <span class="keyword">break</span>; &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">rep</span>(j, <span class="number">1</span>, <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="keyword">int</span> x = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">per</span>(k, m, <span class="number">1</span>) x = x * <span class="number">3</span> + (j + nw[k]) % <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">if</span>(!x || vs[x] || idx == n) <span class="keyword">break</span>;</span><br><span class="line">        A[++idx] = x, vs[x] = vs[t - x] = <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">rep</span>(k, <span class="number">1</span>, m) c[k] += (j + nw[k]) % <span class="number">3</span> - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>), cin.<span class="built_in">tie</span>(<span class="number">0</span>), cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">while</span>(t - <span class="number">3</span> &gt;&gt; <span class="number">1</span> &lt; n) m++, t *= <span class="number">3</span>;</span><br><span class="line">    t--, vs[t / <span class="number">2</span>] = <span class="number">1</span>, <span class="built_in">wrt</span>(m, <span class="number">10</span>), nw[m] = <span class="number">-1</span>, <span class="built_in">dfs</span>(m - <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(n % <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="built_in">rep</span>(i, <span class="number">1</span>, m) as += <span class="built_in">abs</span>(c[i]);</span><br><span class="line">        <span class="keyword">int</span> th = <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">rep</span>(j, <span class="number">1</span>, m) &#123;</span><br><span class="line">            <span class="built_in">rep</span>(i, <span class="number">1</span>, n) &#123;</span><br><span class="line">                <span class="keyword">if</span>(!c[j]) <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">int</span> v = A[i] / th % <span class="number">3</span>;</span><br><span class="line">                <span class="keyword">auto</span> Try = [&amp;](<span class="keyword">int</span> x) &#123;</span><br><span class="line">                    <span class="keyword">int</span> nw = A[i] + x * th;</span><br><span class="line">                    <span class="keyword">if</span>(vs[nw]) <span class="keyword">return</span>;</span><br><span class="line">                    vs[A[i]] = vs[t - A[i]] = <span class="number">0</span>, vs[nw] = vs[t - nw] = <span class="number">1</span>;</span><br><span class="line">                    as -= <span class="built_in">abs</span>(c[j]), c[j] += x, v += x, as += <span class="built_in">abs</span>(c[j]), A[i] = nw;</span><br><span class="line">                &#125;;</span><br><span class="line">                <span class="keyword">if</span>(v &lt; <span class="number">2</span> &amp;&amp; c[j] &lt; <span class="number">0</span>) <span class="built_in">Try</span>(<span class="number">1</span>);</span><br><span class="line">                <span class="keyword">if</span>(v &gt; <span class="number">0</span> &amp;&amp; c[j] &gt; <span class="number">0</span>) <span class="built_in">Try</span>(<span class="number">-1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            th *= <span class="number">3</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">rep</span>(i, <span class="number">1</span>, n) <span class="built_in">wrt</span>(A[i], <span class="number">32</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<h3 id="思路三">思路三</h3>
<p>这是官方解法，说是爬山算法，但感觉比较微妙，因为稍微扰动一下初始解就会有极个别 <span class="math inline">\(n\)</span> 跑不出来，流程是这样的：</p>
<ul>
<li><p>用 <span class="math inline">\(\sum_{j=1}^m|\sum_{i=1}^nA_{i,j}|\)</span> 作为一个解的权值，问题就是求权值最小的解。</p></li>
<li><p><span class="math inline">\(A\)</span> 矩阵初始为空，然按字典序<strong>从大到小</strong>枚举长度为 <span class="math inline">\(m\)</span>，值域为 <span class="math inline">\(\{-1,0,1\}\)</span> 的序列 <span class="math inline">\(B\)</span>，如果 <span class="math inline">\(B\)</span> 和 <span class="math inline">\(-B\)</span> 没有在 <span class="math inline">\(A\)</span> 出现过，就把 <span class="math inline">\(B,\text{next}(B),\text{next}(\text{next}(B))\)</span> 依次加入 <span class="math inline">\(A\)</span> 末尾，加入 <span class="math inline">\(n\)</span> 行时终止。那么 <span class="math inline">\(\forall j\in[1,m],|\sum_{i=1}^nA_{i,j}|\le 1\)</span>。</p></li>
<li><p>对当前解重复进行如下修改，直到权值为 <span class="math inline">\(0\)</span>：</p>
<p>从小到大依次枚举 <span class="math inline">\(j\)</span> 和 <span class="math inline">\(i\)</span>，然后进行以下操作：</p>
<ul>
<li>如果 <span class="math inline">\(\sum_{i=1}^nA_{i,j}=-1\land A_{i,j}&lt;1\)</span>，尝试让 <span class="math inline">\(A_{i,j}\)</span> 加一。</li>
<li>如果 <span class="math inline">\(\sum_{i=1}^nA_{i,j}=1\)</span>，尝试让 <span class="math inline">\(A_{i,j}=0\)</span>。</li>
</ul></li>
</ul>
<p>实测能构造出 <span class="math inline">\(10^6\)</span> 内的所有 <span class="math inline">\(n\)</span>。</p>
<details>
<summary>
<span style="font-size: large; font-weight: bold; color: rgb(33,150,243);">查看代码</span>
</summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rep(i, l, r) for(int i = (l); i &lt;= (r); i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> per(i, r, l) for(int i = (r); i &gt;= (l); i--)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> mem(a, b) memset(a, b, sizeof a)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> For(i, l, r) for(int i = (l), i##e = (r); i &lt; i##e; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pb push_back</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> ll = <span class="keyword">long</span> <span class="keyword">long</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">wrt</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> ed)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> streambuf* out = cout.<span class="built_in">rdbuf</span>();</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> pc out -&gt; sputc</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">char</span> c[<span class="number">11</span>]; <span class="keyword">int</span> sz = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span> c[++sz] = x % <span class="number">10</span>, x /= <span class="number">10</span>; <span class="keyword">while</span>(x);</span><br><span class="line">    <span class="keyword">while</span>(sz) <span class="built_in">pc</span>(c[sz--] + <span class="number">48</span>);</span><br><span class="line">    <span class="built_in">pc</span>(ed);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> n, m = <span class="number">2</span>, t = <span class="number">9</span>, nw[<span class="number">15</span>], idx, A[<span class="number">797170</span>], c[<span class="number">15</span>], as;</span><br><span class="line"><span class="keyword">bool</span> vs[<span class="number">1600000</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(i) <span class="built_in">per</span>(j, <span class="number">1</span>, <span class="number">-1</span>) &#123; nw[i] = j, <span class="built_in">dfs</span>(i - <span class="number">1</span>); <span class="keyword">if</span>(idx == n) <span class="keyword">break</span>; &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">rep</span>(j, <span class="number">1</span>, <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="keyword">int</span> x = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">per</span>(k, m, <span class="number">1</span>) x = x * <span class="number">3</span> + (j + nw[k]) % <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">if</span>(x == t || vs[x] || idx == n) <span class="keyword">break</span>;</span><br><span class="line">        A[++idx] = x, vs[x] = vs[t - x] = <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">rep</span>(k, <span class="number">1</span>, m) c[k] += (j + nw[k]) % <span class="number">3</span> - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>), cin.<span class="built_in">tie</span>(<span class="number">0</span>), cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">while</span>(t - <span class="number">3</span> &gt;&gt; <span class="number">1</span> &lt; n) m++, t *= <span class="number">3</span>;</span><br><span class="line">    t--, vs[t / <span class="number">2</span>] = <span class="number">1</span>, <span class="built_in">wrt</span>(m, <span class="number">10</span>), nw[m] = <span class="number">1</span>, <span class="built_in">dfs</span>(m - <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">rep</span>(i, <span class="number">1</span>, m) as += <span class="built_in">abs</span>(c[i]);</span><br><span class="line">    <span class="keyword">while</span>(as) &#123;</span><br><span class="line">        <span class="keyword">int</span> th = <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">rep</span>(j, <span class="number">1</span>, m) &#123;</span><br><span class="line">            <span class="built_in">rep</span>(i, <span class="number">1</span>, n) &#123;</span><br><span class="line">                <span class="keyword">if</span>(!c[j]) <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">int</span> v = A[i] / th % <span class="number">3</span>;</span><br><span class="line">                <span class="keyword">auto</span> Try = [&amp;](<span class="keyword">int</span> x) &#123;</span><br><span class="line">                    <span class="keyword">int</span> nw = A[i] + x * th;</span><br><span class="line">                    <span class="keyword">if</span>(vs[nw]) <span class="keyword">return</span>;</span><br><span class="line">                    vs[A[i]] = vs[t - A[i]] = <span class="number">0</span>, vs[nw] = vs[t - nw] = <span class="number">1</span>;</span><br><span class="line">                    as -= <span class="built_in">abs</span>(c[j]), c[j] += x, v += x, as += <span class="built_in">abs</span>(c[j]), A[i] = nw;</span><br><span class="line">                &#125;;</span><br><span class="line">                <span class="keyword">if</span>(v &lt; <span class="number">2</span> &amp;&amp; c[j] &lt; <span class="number">0</span>) <span class="built_in">Try</span>(<span class="number">1</span>);</span><br><span class="line">                <span class="keyword">if</span>(v &gt; <span class="number">0</span> &amp;&amp; c[j] &gt; <span class="number">0</span>) <span class="built_in">Try</span>(-v);</span><br><span class="line">            &#125;</span><br><span class="line">            th *= <span class="number">3</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">rep</span>(i, <span class="number">1</span>, n) <span class="built_in">wrt</span>(A[i], <span class="number">32</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<h3 id="auoj1761">AUOJ1761</h3>
<blockquote>
<p>有一个长度为 <span class="math inline">\(n\)</span> 的序列 <span class="math inline">\(A\)</span> （下标从 <span class="math inline">\(1\)</span> 开始）和一个长度为 <span class="math inline">\(m\)</span> 的序列 <span class="math inline">\(B\)</span>（下标从 <span class="math inline">\(0\)</span> 开始）。</p>
<p><span class="math inline">\(A\)</span> 初始全为 <span class="math inline">\(0\)</span>，每一天 <span class="math inline">\(A_i\)</span> 会增加 <span class="math inline">\(i\)</span>，在第 <span class="math inline">\(j\)</span> 天，如果 <span class="math inline">\(A_i&gt;B_{j\bmod m}\)</span>，则进行一次操作，令 <span class="math inline">\(A_i=B_{j\bmod m}\)</span>。</p>
<p><span class="math inline">\(q\)</span> 次询问，每次询问前 <span class="math inline">\(d_i\)</span> 天总共会进行多少次操作。</p>
<p><span class="math inline">\(n,m,q\le 3\cdot 10^5,d_i\le 3\cdot 10^{12},t_i\le 10^{18}\)</span></p>
</blockquote>
<p>由于 <span class="math inline">\(d_i\)</span> 很大，应该会用到操作的周期性，事实上对于每个 <span class="math inline">\(A_i\)</span>，从第一次操作它开始周期就为 <span class="math inline">\(m\)</span>。</p>
<blockquote>
<p>引理：假设在第 <span class="math inline">\(p\)</span> 天操作了 <span class="math inline">\(A_i\)</span>，那么它在第 <span class="math inline">\(p+m\)</span> 天又会被操作。</p>
</blockquote>
<p>证明：第 <span class="math inline">\(p-m\)</span> 天 <span class="math inline">\(A_i\)</span> 小于等于第 <span class="math inline">\(p\)</span> 天的 <span class="math inline">\(A_i=B_{p \bmod m}\)</span>，感性理解 <span class="math inline">\(A_i\)</span> 越小在 <span class="math inline">\(m\)</span> 天后越容易操作，第 <span class="math inline">\(p\)</span> 天操作了，第 <span class="math inline">\(p+m\)</span> 天肯定要操作。</p>
<p>设 <span class="math inline">\(A_i\)</span> 第一次操作在第 <span class="math inline">\(p_i\)</span> 天，那么在第 <span class="math inline">\(p_i,p_i+m,p_i+2m,pi+3m,\cdots\)</span> 都会操作，于是周期就是 <span class="math inline">\(m\)</span>。</p>
<p>不难发现 <span class="math inline">\(p_i\)</span> 是递减的，因为任意时刻 <span class="math inline">\(A\)</span> 序列都是递增的，每次操作的都是一段后缀。那么对于一次询问，进行过操作的 <span class="math inline">\(A_i\)</span> 是一段后缀，只要求出了 <span class="math inline">\(p_i\)</span> 就可以二分出这个后缀，下面考虑怎么求 <span class="math inline">\(p_i\)</span>。</p>
<p>设 <span class="math inline">\(pos\)</span> 表示 <span class="math inline">\(B\)</span> 中最小元素的位置，对于每个 <span class="math inline">\(i\)</span> 可以直接算出 <span class="math inline">\(A_i\)</span> 第一次被 <span class="math inline">\(B_{pos}\)</span> 操作的时间 <span class="math inline">\(T_i\)</span>，那么 <span class="math inline">\(p_i\in[T_i-m+1,T_i]\)</span>，设 <span class="math inline">\(p_i=T_i-m+k_i\)</span>，<span class="math inline">\(k_i\)</span> 就是最小的 <span class="math inline">\(x\)</span> 满足 <span class="math inline">\(ix+(T_i-m)i&gt;B_{pos+x}\)</span>，考虑在线段树上每个结点 <span class="math inline">\([l,r]\)</span> 维护 <span class="math inline">\(\min_{j=l}^rB_{pos+j}-ij\)</span>，每次只需要二分出最小的 <span class="math inline">\(x\)</span> 满足 <span class="math inline">\(\min_{j=1}^x\{B_{pos+j}-ij\}&lt;(T_i-m)i\)</span>，注意到式子是可以斜率优化的，随着 <span class="math inline">\(i\)</span> 的增大，对每个结点用一个单调队列维护下凸包。复杂度为 <span class="math inline">\(O(n\log n)\)</span>。这样就求出了 <span class="math inline">\(p_i\)</span>。</p>
<p>对于询问 <span class="math inline">\(d\)</span>，每个 <span class="math inline">\(A_i\)</span> 的贡献可以分为若干个完整周期和一个不完整周期。对于完整周期，由于周期长度为 <span class="math inline">\(m\)</span>，可以用线段树直接模拟周期中每一天的修改，然后就知道每个 <span class="math inline">\(A_i\)</span> 一个周期被清理多少次。对于不完整周期，可以把所有询问离线下来，然后用一个线段树模拟这个不完整周期，大致思路是在 <span class="math inline">\(p_i\bmod m\)</span> 天插入 <span class="math inline">\(A_i\)</span>，在 <span class="math inline">\(d\bmod m\)</span> 天进行查询，但有可能 <span class="math inline">\(d\bmod m&lt;p_i\bmod m\)</span>，所以实现上需要分类讨论一下。</p>
<h3 id="catoj1009">CatOJ1009</h3>
<blockquote>
<p>定义一个正整数是好的当且仅当它的十进制表示是它的二进制表示的后缀。</p>
<p>求第 <span class="math inline">\(k\)</span> 小的好数。</p>
<p><span class="math inline">\(k\le 10^4\)</span></p>
</blockquote>
<p>考虑怎么判断一个 <span class="math inline">\(n\)</span> 位数 <span class="math inline">\(x\)</span> 是否是好的，首先它的十进制表示只能有 <span class="math inline">\(01\)</span>，其次 <span class="math inline">\(x\bmod 2^n\)</span> 的二进制表示要和 <span class="math inline">\(x\)</span> 的十进制表示相同。</p>
<p>第 <span class="math inline">\(10^4\)</span> 个好数是 <span class="math inline">\(163\)</span> 位数，可以 <code>DFS</code> 出所有位数不超过 <span class="math inline">\(163\)</span> 的好数，从低位往高位枚举每一个 <span class="math inline">\(1\)</span> 在哪一位，维护 <span class="math inline">\(x\bmod 2^{163}\)</span>，假设当前最高位为 <span class="math inline">\(n\)</span>，如果 <span class="math inline">\(x\bmod 2^n\)</span> 的二进制表示和 <span class="math inline">\(x\)</span> 的十进制表示不同就结束。由于位数不超过 <span class="math inline">\(163\)</span> 的好数不多，复杂度可以接受。</p>
<h3 id="catoj1011">CatOJ1011</h3>
<blockquote>
<p>一种代码由 <code>+,-,[,]</code> 四种字符组成，还有一个初始为 <span class="math inline">\(0\)</span> 的存储单元。</p>
<p>规则为从左到右执行代码的每一个字符：</p>
<ul>
<li><code>+</code>：存储单元加一。</li>
<li><code>-</code>：存储单元减一。</li>
<li><code>[</code>：如果存储单元为 <span class="math inline">\(0\)</span>，跳转到与之匹配的 <code>]</code>。</li>
<li><code>]</code>：如果存储单元不为 <span class="math inline">\(0\)</span>，跳转到与之匹配的 <code>[</code> 。</li>
</ul>
<p>求出长度为 <span class="math inline">\(n\)</span> 的合法代码（括号序列合法）中，有多少个会在有限步内结束。</p>
<p><span class="math inline">\(n \le 100\)</span></p>
</blockquote>
<p>先分析一下合法代码的性质：走出一个括号后，储存单元的值必然是 <span class="math inline">\(0\)</span>，对于任意一段代码和一个输入 <span class="math inline">\(x\)</span> （输入为开始时储存单元的值，输出为结束后存储单元的值），如果有输出（即能跑完），那么其输出 <span class="math inline">\(y\)</span> 只有两种形式：</p>
<ul>
<li>在代码中只有 <code>+-</code> 时 <span class="math inline">\(y=x+d\)</span>。</li>
<li>在代码中有括号时 <span class="math inline">\(y=d\)</span>。</li>
</ul>
<p>首先预处理 <span class="math inline">\(g_{i,j}\)</span> 表示长度为 <span class="math inline">\(i\)</span> 的代码中，形式为 <span class="math inline">\(y=x+j\)</span> 的代码数，<span class="math inline">\(h_i\)</span> 表示长度为 <span class="math inline">\(i\)</span> 的合法代码数。</p>
<p>根据这个性质，设计 <code>DP</code> 状态 <span class="math inline">\(f_{i,j}\)</span> 表示长度为 <span class="math inline">\(i\)</span> 的代码中，输入为 <span class="math inline">\(j\)</span>，输出为 <span class="math inline">\(0\)</span> 的代码数，转移为：</p>
<ul>
<li><p>第一位为 <code>+-</code>，从 <span class="math inline">\(f_{i-1,j\pm 1}\)</span> 转移来。</p></li>
<li><p>第一位为 <code>[</code>，枚举第一对括号中代码的长度 <span class="math inline">\(k\)</span>，分两种情况：</p>
<ul>
<li><p><span class="math inline">\(j=0\)</span>，此时会直接跳过第一对括号，括号内的方案数位 <span class="math inline">\(h_k\)</span>。</p></li>
<li><p><span class="math inline">\(j\ne 0\)</span>。</p>
<ul>
<li>括号内代码形式为 <span class="math inline">\(y=0\)</span> 或 <span class="math inline">\(y=x-j\)</span>，方案数为 <span class="math inline">\(f_{k,j}\)</span>。</li>
<li>括号内代码形式为 <span class="math inline">\(y=x+d\)</span>，其中 <span class="math inline">\(d\)</span> 为 <span class="math inline">\(j\)</span> 的真因数，且与 <span class="math inline">\(j\)</span> 的符号相反，方案数为 <span class="math inline">\(g_{k,d}\)</span>。</li>
</ul></li>
<li><p>括号外方案数为 <span class="math inline">\(f_{i-k-2,0}\)</span>。</p></li>
</ul></li>
</ul>
<p>统计答案时需要计算 <span class="math inline">\(F_i\)</span> 表示长度为 <span class="math inline">\(i\)</span> 的代码中，输入为 <span class="math inline">\(0\)</span>，输出为 <span class="math inline">\(0\)</span>，且以 <code>]</code> 结尾的代码数。</p>
<p><span class="math display">\[
F_i=f_{i,0}-\sum_{j=0}^{i-1}F_jg_{i-j,0}
\]</span></p>
<p>答案为</p>
<p><span class="math display">\[
\sum_{i=0}^nF_i2^{n-i}
\]</span></p>
<p>由于 <code>+-</code> 的对称性，<span class="math inline">\(f_{i,j}=f_{i,-j},g_{i,j}=g_{i,-j}\)</span>，实现上并不需要存下标为负数的状态。</p>
<p>复杂度 <span class="math inline">\(O(n^3\log n)\)</span>。</p>

    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/sundays/" rel="prev" title="每周日练习">
                  <i class="fa fa-chevron-left"></i> 每周日练习
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/tmp/" rel="next" title="tmp">
                  tmp <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments" id="SOHUCS"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">platelet</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">197k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">2:59</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="/js/third-party/search/local-search.js"></script>




  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<script class="next-config" data-name="changyan" type="application/json">{"enable":true,"appid":"cyvEvVbLv","appkey":"5ad530a5ec52a4592621eb7b7437748c"}</script>
<script src="/js/third-party/comments/changyan.js"></script>

</body>
</html>
